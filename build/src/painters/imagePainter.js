define(["require","flight/lib/component","painters/withImagePainter","painters/withOutlinePainter","painters/withCanvasEvents","outlineShapes/rectOutline"],function(t){function e(){this.defaultAttrs({canvas:void 0,rectOutline:void 0,files:[]}),this.after("initialize",function(){this.attachEventListener(),this.requestCanvas()}),this.requestCanvas=function(){this.trigger("request-canvas")},this.setCanvas=function(t){this.attr.canvas=t,this.attr.rectOutline=new o(t,{})},this.attachEventListener=function(){this.on("canvas-served",function(t,e){this.setCanvas(e.canvas)}.bind(this)),this.on("imageCanvas-clicked",function(t,e){this.trigger("cancel-painting",{active:"image"}),this.initImagePainting(e.files)}.bind(this)),this.on("cancel-painting",function(t,e){"image"!==e.active&&this.stopCurrentPainting()}.bind(this)),this.on("images-added",function(){this.stopCurrentPainting()}.bind(this))},this.stopCurrentPainting=function(){this.off("outlineShape-painting-finished",this.onOutlineShapePaintingFinished),this.unregisterExistingListeners(this.attr.canvas),this.attr.files.length=0},this.initImagePainting=function(t){var e=this.attr.rectOutline;this.attr.files=t,e&&(this.trigger("notify",{type:"info",message:"Press [ESC] to cancel any painting"}),this.on("outlineShape-painting-finished",this.onOutlineShapePaintingFinished),this.startOutlineShapePainting(this.attr.canvas,e,{registerEventListeners:this.registerEventListeners,unregisterExistingListeners:this.unregisterExistingListeners}))},this.onOutlineShapePaintingFinished=function(){this.off("outlineShape-painting-finished",this.onOutlineShapePaintingFinished),this.loadImages(this.attr.files,this.attr.rectOutline)}}var i=t("flight/lib/component"),n=t("painters/withImagePainter"),r=t("painters/withOutlinePainter"),s=t("painters/withCanvasEvents"),o=t("outlineShapes/rectOutline");return i(e,n,s,r)});