define(["require","fabric","flight/lib/component","painters/mixin/withCanvasEvents","painters/mixin/withBrushPainter","painters/mixin/withOutlinePainter","painters/mixin/withActiveBrush","painters/mixin/withActiveOutlineShape"],function(i){function t(){this.defaultAttrs({canvas:void 0}),this.after("initialize",function(){this.attachEventListeners()}),this.attachEventListeners=function(){this.on("brushes-loaded",function(i,t){this.requestBrush(t.brushes[0].id)}),this.on("canvas-ready",function(i,t){this.setupCanvas(t.canvas)}.bind(this)),this.on("cancel-painting",function(i,t){"paint"!==t.active&&this.cancelCurrentPainting()}.bind(this)),this.on("paintWidget-clicked",function(i,t){this.requestOutlineShape(t.paintWidgetId)}.bind(this))},this.setupCanvas=function(i){this.attr.canvas=i},this.requestOutlineShape=function(i){this.on("activeOutlineShape-ready",this.onActiveOutlineShapeReady),this.trigger("activeOutlineShape-changed",{activeOutlineShapeId:i,id:i})},this.onActiveOutlineShapeReady=function(i,t){this.off("activeOutlineShape-ready",this.onActiveOutlineShapeReady),this.trigger("cancel-painting",{active:"paint"}),this.initOutlineShapePainting(t)},this.requestBrush=function(i){this.requestBrushInstance(i)},this.initOutlineShapePainting=function(i){i.activeOutlineShape&&(this.trigger("notify",{type:"info",message:"Press [ESC] to cancel any painting"}),this.cancelCurrentPainting(),this.on("outlineShape-painting-finished",this.onOutlineShapePaintingFinished),this.startOutlineShapePainting(this.attr.canvas,i.activeOutlineShape,{registerEventListeners:this.registerEventListeners,unregisterExistingListeners:this.unregisterExistingListeners}))},this.onOutlineShapePaintingFinished=function(i,t){this.initBrushPainting(t),t.outlineShape.start()},this.initBrushPainting=function(i){var t=this.getActiveBrush();t&&i.outlineShape&&this.startBrushPainting(this.attr.canvas,this.getActiveBrush(),i.outlineShape.getOutlinePoints(t.get("width")))},this.cancelCurrentPainting=function(){this.unregisterExistingListeners(this.attr.canvas),this.off("outlineShape-painting-finished",this.onOutlineShapePaintingFinished)}}var n=(i("fabric"),i("flight/lib/component")),e=i("painters/mixin/withCanvasEvents"),s=i("painters/mixin/withBrushPainter"),a=i("painters/mixin/withOutlinePainter"),h=i("painters/mixin/withActiveBrush"),r=i("painters/mixin/withActiveOutlineShape");return n(t,e,s,a,h,r)});