define(["require","fabric","flight/lib/component","painters/withCanvasEvents","painters/withBrushPainter","painters/withOutlinePainter","painters/withActiveBrush","painters/withActiveOutlineShape"],function(t){function e(){this.defaultAttrs({canvas:void 0}),this.after("initialize",function(){this.attachEventListeners(),this.requestCanvas()}),this.attachEventListeners=function(){this.on("brushes-loaded",function(t,e){this.requestBrush(e.brushes[0].id)}),this.on("canvas-served",function(t,e){this.setupCanvas(e.canvas)}.bind(this)),this.on("cancel-painting",function(t,e){"paint"!==e.active&&this.cancelCurrentPainting()}.bind(this)),this.on("paintWidget-clicked",function(t,e){this.requestOutlineShape(e.paintWidgetId)}.bind(this))},this.requestCanvas=function(){this.trigger("request-canvas")},this.setupCanvas=function(t){this.attr.canvas=t},this.requestOutlineShape=function(t){this.on("activeOutlineShape-ready",this.onActiveOutlineShapeReady),this.trigger("activeOutlineShape-changed",{activeOutlineShapeId:t,id:t})},this.onActiveOutlineShapeReady=function(t,e){this.off("activeOutlineShape-ready",this.onActiveOutlineShapeReady),this.trigger("cancel-painting",{active:"paint"}),this.initOutlineShapePainting(e)},this.requestBrush=function(t){this.requestBrushInstance(t)},this.cancelCurrentPainting=function(){this.unregisterExistingListeners(this.attr.canvas),this.off("outlineShape-painting-finished",this.onOutlineShapePaintingFinished)},this.initOutlineShapePainting=function(t){t.activeOutlineShape&&(this.trigger("notify",{type:"info",message:"Press [ESC] to cancel any painting"}),this.cancelCurrentPainting(),this.on("outlineShape-painting-finished",this.onOutlineShapePaintingFinished),this.startOutlineShapePainting(this.attr.canvas,t.activeOutlineShape,{registerEventListeners:this.registerEventListeners,unregisterExistingListeners:this.unregisterExistingListeners}))},this.onOutlineShapePaintingFinished=function(t,e){this.initBrushPainting(e),e.outlineShape.start()},this.initBrushPainting=function(t){var e=this.getActiveBrush();e&&t.outlineShape&&this.startBrushPainting(this.attr.canvas,this.getActiveBrush(),t.outlineShape.getOutlinePoints(e.get("width")))}}var i=(t("fabric"),t("flight/lib/component")),n=t("painters/withCanvasEvents"),r=t("painters/withBrushPainter"),s=t("painters/withOutlinePainter"),o=t("painters/withActiveBrush"),a=t("painters/withActiveOutlineShape");return i(e,n,r,s,o,a)});